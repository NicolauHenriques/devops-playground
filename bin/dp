#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT_DIR"

cmd="${1:-}"
shift || true

usage() {
  cat <<USAGE
Usage: dp <command> [args...]

Commands:
  health         Run full health check
  services       Run service checks
  net            Run network checks
  cleanup        Cleanup old logs
  backup         Backup logs
  ci             Run fmt-check + lint + test
USAGE
}

case "$cmd" in
  health) ./full_health.sh "$@" ;;
  services) ./service_check.sh "$@" ;;
  net) ./net_check.sh "$@" ;;
  cleanup) ./cleanup_logs.sh "$@" ;;
  backup) ./backup_logs.sh "$@" ;;
  ci) make ci ;;
  "" | -h | --help) usage ;;
  *)
    echo "Unknown command: $cmd" >&2
    usage
    exit 2
    ;;
esac
